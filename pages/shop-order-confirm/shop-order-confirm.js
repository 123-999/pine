(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop-order-confirm/shop-order-confirm"],{3729:function(e,t,r){"use strict";r.r(t);var s=r("cbcf"),a=r.n(s);for(var o in s)"default"!==o&&function(e){r.d(t,e,(function(){return s[e]}))}(o);t["default"]=a.a},"6f36":function(e,t,r){"use strict";r.r(t);var s=r("88b5"),a=r("3729");for(var o in a)"default"!==o&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r("bb55");var n,d=r("f0c5"),i=Object(d["a"])(a["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],n);t["default"]=i.exports},"88b5":function(e,t,r){"use strict";var s,a=function(){var e=this,t=e.$createElement;e._self._c},o=[];r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return s}))},ab8a:function(e,t,r){},bb55:function(e,t,r){"use strict";var s=r("ab8a"),a=r.n(s);a.a},cbcf:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(r("a34a"));r("4240");function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r,s,a,o,n){try{var d=e[o](n),i=d.value}catch(u){return void r(u)}d.done?t(i):Promise.resolve(i).then(s,a)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function d(e){o(n,s,a,d,i,"next",e)}function i(e){o(n,s,a,d,i,"throw",e)}d(void 0)}))}}var d={data:function(){return{user:{},orderGoods:{},address:{},total:0,type:1,seat:0,isShowAddress:0}},onLoad:function(){var t=n(s.default.mark((function t(r){var a,o,n;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.type=r.type,this.seat=r.seat,this.orderGoods=e.getStorageSync("orderGoods"),1!=this.seat)for(a=0;a<this.orderGoods.length;a++)0==this.total?this.total=parseFloat(this.orderGoods[a].price)*this.orderGoods[a].buynumber:(this.total=parseFloat(this.total)+parseFloat(this.orderGoods[a].price)*this.orderGoods[a].buynumber,this.address=this.orderGoods[0].address);else this.total=parseFloat(this.orderGoods[0].total);return this.total=this.total.toFixed(2),t.next=7,e.getStorageSync("address");case 7:o=t.sent,e.getStorageSync("userid"),e.getStorageSync("nickname"),void 0!=typeof o&&null!=o&&o.address?this.address=o:(this.isShowAddress=1,n={},n.name="",n.phone="",n.address="",this.address=n);case 11:case"end":return t.stop()}}),t,this)})));function r(e){return t.apply(this,arguments)}return r}(),onShow:function(){var t=n(s.default.mark((function t(){var r,a,o,n,d;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.getStorageSync("userid"),e.getStorageSync("nickname"),a=e.getStorageSync("nowTable"),t.next=5,this.$api.session(a);case 5:if(o=t.sent,this.user=o.data,n=e.getStorageSync("address"),1==this.seat){t.next=17;break}if(!n||this.user.id!=r){t.next=13;break}this.address=e.getStorageSync("address"),t.next=17;break;case 13:return t.next=15,this.$api.defaultAddress(r);case 15:o=t.sent,this.address=o.data;case 17:void 0!=typeof n&&null!=n&&n.address||(this.isShowAddress=1,d={},d.name="",d.phone="",d.address="",this.address=d);case 18:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),methods:{onSubmitTap:function(){var t=n(s.default.mark((function t(){var r,a;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=this,1==r.seat||r.address.address){t.next=4;break}return r.$utils.msg("请选择地址"),t.abrupt("return");case 4:a=e.getStorageSync("nowTable"),e.showModal({title:"提示",content:"是否确认支付",success:function(){var t=n(s.default.mark((function t(o){var n,d,i,u,c,l,f;return s.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o.confirm){t.next=58;break}if(n=r.type,d=!0,i="已支付",1!=n){t.next=8;break}r.user.money-r.total<0&&(r.$utils.msg("余额不足，请先充值"),d=!1,i="未支付"),t.next=13;break;case 8:if(2!=n){t.next=13;break}if(!(r.user.jifen-r.total<0)){t.next=13;break}return r.$utils.msg("积分不足，兑换商品失败"),d=!1,t.abrupt("return");case 13:u=0;case 14:if(!(u<r.orderGoods.length)){t.next=44;break}if("shangpinxinxi"!=r.orderGoods[u].tablename){t.next=33;break}return t.next=18,r.$api.info("shangpinxinxi",r.orderGoods[u].goodid);case 18:if(c=t.sent,!(c.data.onelimittimes>0)){t.next=24;break}if(!(r.orderGoods[u].buynumber>c.data.onelimittimes)){t.next=24;break}return r.$utils.msg("".concat(r.orderGoods[u].goodname,"超过可购买数量")),d=!1,t.abrupt("break",44);case 24:if(!(c.data.alllimittimes<r.orderGoods[u].buynumber)){t.next=30;break}return r.$utils.msg("".concat(r.orderGoods[u].goodname,"已售罄")),d=!1,t.abrupt("break",44);case 30:return 1!=r.seat?c.data.alllimittimes=c.data.alllimittimes-r.orderGoods[u].buynumber:c.data.selected=c.data.selected+","+r.orderGoods[u].activeSeat,t.next=33,r.$api.update("shangpinxinxi",c.data);case 33:return l={orderid:r.$utils.genTradeNo(),tablename:r.orderGoods[u].tablename,userid:r.user.id,goodid:r.orderGoods[u].goodid,goodname:r.orderGoods[u].goodname,picture:r.orderGoods[u].picture,buynumber:r.orderGoods[u].buynumber,discountprice:r.orderGoods[u].price,price:r.orderGoods[u].price,total:r.orderGoods[u].price*r.orderGoods[u].buynumber,discounttotal:r.orderGoods[u].price*r.orderGoods[u].buynumber,type:n,address:r.address.address,tel:r.address.phone,consignee:r.address.name,status:i},1==r.seat&&(l["address"]=r.address,f=r.address.split(",").length,l["buynumber"]=f,l["total"]=r.orderGoods[u].price*f,l["discounttotal"]=r.orderGoods[u].price*f),t.next=37,r.$api.add("orders",l);case 37:if(!r.orderGoods[u].id){t.next=41;break}return t.next=40,r.$api.del("cart",JSON.stringify([r.orderGoods[u].id]));case 40:e.removeStorageSync("cart".concat(r.orderGoods[u].goodid).concat(r.user.id));case 41:u++,t.next=14;break;case 44:if(!d){t.next=58;break}if(1!=n){t.next=53;break}return r.$utils.msgBack("支付成功"),r.user.money=r.user.money-r.total,(r.user.jifen||0==r.user.jifen)&&(r.user.jifen=parseFloat(r.user.jifen)+parseFloat(r.total)),t.next=51,r.$api.update(a,r.user);case 51:t.next=58;break;case 53:if(2!=n){t.next=58;break}return r.$utils.msgBack("兑换成功"),r.user.jifen=r.user.jifen-r.total,t.next=58,r.$api.update(a,r.user);case 58:case"end":return t.stop()}}),t)})));function o(e){return t.apply(this,arguments)}return o}()});case 6:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),onAddressTap:function(){this.$utils.jump("../shop-address/shop-address")}}};t.default=d}).call(this,r("543d")["default"])},f9b4:function(e,t,r){"use strict";(function(e){r("78e1"),r("921b");s(r("66fd"));var t=s(r("6f36"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])}},[["f9b4","common/runtime","common/vendor"]]]);